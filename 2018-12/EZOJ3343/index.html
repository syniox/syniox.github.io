<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>[EZOJ3343] 程序锁 - Blog | qzkszj</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0/normalize.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0/build/pure-min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0/build/grids-responsive-min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/atom-one-light.css"><style>.category-list-item{display:flex}.category-list-link{flex:1 0 auto}.category-list-count{text-align:right}.post .post-content pre code{padding:0 0}</style><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Blog | qzkszj" type="application/atom+xml"></head><body class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[EZOJ3343] 程序锁</h1><a id="logo" href="/">Blog | qzkszj</a><p class="description">过往如烟。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined">Home</i></a><a href="/archives/"><i class="fa undefined"> Archive</i></a><a href="/about/"><i class="fa undefined"> About</i></a><a href="/atom.xml"><i class="fa undefined"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">[EZOJ3343] 程序锁</h1><div class="post-meta">December 28,2018<span> | </span><span class="category"><a href="/categories/Solution/">Solution</a></span><span> | 1.2k,4 mins.</span><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span></span><span id="busuanzi_container_page_pv"> | views: <span id="busuanzi_value_page_pv"></span></span></div><div class="tags"></div><div class="post-content"><p><a target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?id=3343">题意</a>：<br>两个串，有一些地方已经被填上了-1,1。<br>现在有两个指针让你操作，每次可以选择一个指针向前移动一步，扫完序列的指针不能再动。<br>当两个指针走过路径的和（前缀和）小于0时就失败了。</p><p>指针的操作方式有一些限制：两个指针下一步中一个是1,另一个是-1时，必须走1的那一个指针。<br>现在要你把剩下的空位填上-1或1，问无论怎么走都能在不失败的情况下填数的方案。</p><p>序列长度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>5000</mn></mrow><annotation encoding="application/x-tex">\leq 5000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7719400000000001em;vertical-align:-.13597em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span></p><hr><p>先考虑对于一个特定的情况合不合法。<br>考虑走的过程中的最小值。<br>实际上达到最小值的情况是走了一步-1:</p><ul><li>两个指针后面都是-1</li><li>一个指针走到了终点</li></ul><p>所以在走最小值前一步时，两个点都会在-1前或终点处。<br>所以可以只用考虑-1前面的点和终点处 两个序列的最小前缀和 之和。（下文中最小前缀和均代表-1前面的点和终点处的前缀和的最小值）<br>当这个最小值&lt;1时就意味这他们无法再应对之后到来的-1,所以这里前缀和之和需要&gt;0。<br>（两个点都在终点处时两个序列都不会再-1了，这时&gt;=0即可，下文不再考虑）</p><p>有一个这样的性质：当一个指针在-1之前或结尾时，另一个指针是可以随便跑的。<br>所以说满足前面指针条件的任何前缀和之和&lt;=0的情况，都可以在一个点到达目标点后直接将另一个点移至对应的最小值，导致任务失败。<br>所以-1前和终点处的最小前缀和的条件对答案是必要的。</p><p>“为什么这样就可行呢？如果两个后面都是-1的话为什么不可能时前缀和从1变成-1？”<br>考虑最小前缀和之和为1的情况：<br>考虑走一步。<br>这时候一个点在-1上，另一个点在-1前，这时前缀和之和为0。<br>在-1前的点能走到-1的条件是另一行的下一个点也要是-1或者另一行走到了结尾。<br>无论是结尾处的前缀和还是下一个-1前的前缀和显然都要被统计（这里比原最小前缀和多了个-1），这样最小前缀和就不是1了。<br>与假设相矛盾。</p><p>会发现这时候答案只和两行的最小前缀和有关，于是可以分开来DP。<br>发现从前往后DP还同时记录历史最小前缀和和结尾的前缀和，十分麻烦，于是考虑从后往前。</p><p>用DP[i][j][k(0/1)]表示目前第i位,当前串最小前缀和为j，结尾前缀和与最小前缀和的关系为k的方案数。<br>（只要前面有和结尾相同的前缀和，最小前缀和就不应该与结尾有关了）<br>这时候往前新加一个数会发现最小前缀和要么加上增量，要么变成-1（新加的数）。<br>两边分别DP出来后前缀和优化卷积，对符合条件的求和就行。<br>在实际DP时并不需要考虑后一项是不是-1的问题，只需要判断开始处的0是否需要被考虑。</p><p><a target="_blank" rel="noopener" href="https://github.com/syniox/Online_Judge_solutions/blob/master/XSY/3343.cpp">code</a>:</p><pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span>
<span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> lint;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5005</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">998244353</span>;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt; <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">twk</span><span class="hljs-params">(T &amp;x)</span></span>&#123;
	<span class="hljs-keyword">if</span>(x&gt;=mod) x-=mod;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">nxi</span><span class="hljs-params">()</span></span>&#123;
	<span class="hljs-type">int</span> x=<span class="hljs-number">0</span>;
	<span class="hljs-type">char</span> c;
	<span class="hljs-keyword">while</span>((c=<span class="hljs-built_in">getchar</span>())&gt;<span class="hljs-string">&#x27;9&#x27;</span>||c&lt;<span class="hljs-string">&#x27;0&#x27;</span>);
	<span class="hljs-keyword">while</span>(x=x*<span class="hljs-number">10</span><span class="hljs-number">-48</span>+c,(c=<span class="hljs-built_in">getchar</span>())&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="hljs-string">&#x27;9&#x27;</span>);
	<span class="hljs-keyword">return</span> x;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> dp[][<span class="hljs-number">2</span>])</span></span>&#123;
	<span class="hljs-type">static</span> <span class="hljs-type">int</span> tdp[N&lt;&lt;<span class="hljs-number">1</span>][<span class="hljs-number">2</span>];
	<span class="hljs-type">static</span> <span class="hljs-type">char</span> ch[N];
	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,ch+<span class="hljs-number">1</span>);
	<span class="hljs-type">int</span> n=<span class="hljs-built_in">strlen</span>(ch+<span class="hljs-number">1</span>);
	dp[N][<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n; i; --i)&#123;
		<span class="hljs-type">const</span> <span class="hljs-type">int</span> dis=n-i+<span class="hljs-number">1</span>;
		<span class="hljs-built_in">memcpy</span>(tdp+N-dis,dp+N-dis,((dis+<span class="hljs-number">1</span>)&lt;&lt;<span class="hljs-number">1</span>)*<span class="hljs-built_in">sizeof</span>(tdp[<span class="hljs-number">0</span>]));
		<span class="hljs-built_in">memset</span>(dp+N-dis,<span class="hljs-number">0</span>,((dis+<span class="hljs-number">1</span>)&lt;&lt;<span class="hljs-number">1</span>)*<span class="hljs-built_in">sizeof</span>(tdp[<span class="hljs-number">0</span>]));
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=N-dis; j&lt;=N+dis; ++j)&#123;
			<span class="hljs-keyword">if</span>(ch[i]!=<span class="hljs-string">&#x27;V&#x27;</span>)&#123;
				<span class="hljs-keyword">if</span>(j&lt;=N)&#123;
					<span class="hljs-built_in">twk</span>(dp[j<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>]+=tdp[j][<span class="hljs-number">0</span>]);
					<span class="hljs-built_in">twk</span>(dp[j<span class="hljs-number">-1</span>][<span class="hljs-number">1</span>]+=tdp[j][<span class="hljs-number">1</span>]);
				&#125;
				<span class="hljs-keyword">else</span>&#123;
					<span class="hljs-built_in">twk</span>(dp[N][<span class="hljs-number">0</span>]+=tdp[j][<span class="hljs-number">0</span>]);
					<span class="hljs-built_in">twk</span>(dp[N][<span class="hljs-number">0</span>]+=tdp[j][<span class="hljs-number">1</span>]);
				&#125;
			&#125;
			<span class="hljs-keyword">if</span>(ch[i]!=<span class="hljs-string">&#x27;P&#x27;</span>)&#123;
				<span class="hljs-built_in">twk</span>(dp[j+<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]+=tdp[j][<span class="hljs-number">0</span>]);
				<span class="hljs-built_in">twk</span>(dp[j+<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]+=tdp[j][<span class="hljs-number">1</span>]);
			&#125;
		&#125;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-type">int</span> dp0[][<span class="hljs-number">2</span>],<span class="hljs-type">int</span> dp1[][<span class="hljs-number">2</span>])</span></span>&#123;
	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;N&lt;&lt;<span class="hljs-number">1</span>; ++i)&#123;
		ans=(ans+(lint)dp0[i][<span class="hljs-number">1</span>]*dp1[(N&lt;&lt;<span class="hljs-number">1</span>)-i][<span class="hljs-number">1</span>])%mod;
	&#125;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=(N&lt;&lt;<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>; i; --i)&#123;
		<span class="hljs-built_in">twk</span>(dp1[i<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>]+=dp1[i][<span class="hljs-number">0</span>]);
		<span class="hljs-built_in">twk</span>(dp1[i<span class="hljs-number">-1</span>][<span class="hljs-number">1</span>]+=dp1[i][<span class="hljs-number">1</span>]);
	&#125;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;N&lt;&lt;<span class="hljs-number">1</span>; ++i)&#123;
		ans=(ans+(lint)(dp0[i][<span class="hljs-number">0</span>]+dp0[i][<span class="hljs-number">1</span>])*dp1[(N&lt;&lt;<span class="hljs-number">1</span>)-i+<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])%mod;
		ans=(ans+(lint)(dp0[i][<span class="hljs-number">0</span>]+dp0[i][<span class="hljs-number">1</span>])*dp1[(N&lt;&lt;<span class="hljs-number">1</span>)-i+<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])%mod;
	&#125;
	<span class="hljs-keyword">return</span> ans;
&#125;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;
	<span class="hljs-type">static</span> <span class="hljs-type">int</span> dp0[N&lt;&lt;<span class="hljs-number">1</span>][<span class="hljs-number">2</span>],dp1[N&lt;&lt;<span class="hljs-number">1</span>][<span class="hljs-number">2</span>];
	<span class="hljs-built_in">get</span>(dp0);
	<span class="hljs-built_in">get</span>(dp1);
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,<span class="hljs-built_in">solve</span>(dp0,dp1));
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;
</code></pre></div><div class="page-navigator"><a class="pre" href="/2019-01/poly/">Previous</a><a class="next" href="/2018-12/Interpolation/">Next</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title">Categories</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Note/">Note</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recollections/">Recollections</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solution/">Solution</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Starred/">Starred</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title">Tags</div><div class="tagcloud"><a href="/tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/" style="font-size:15px">组合数学</a> <a href="/tags/DP-%E4%BC%98%E5%8C%96/" style="font-size:15px">DP/优化</a> <a href="/tags/%E6%95%B0%E8%AE%BA/" style="font-size:16px">数论</a> <a href="/tags/%E5%AE%B9%E6%96%A5/" style="font-size:13px">容斥</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size:13px">集合</a> <a href="/tags/%E5%81%8F%E5%BA%8F/" style="font-size:13px">偏序</a> <a href="/tags/%E6%A0%91/" style="font-size:13px">树</a> <a href="/tags/%E6%8B%93%E6%89%91/" style="font-size:13px">拓扑</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" style="font-size:14px">网络流</a> <a href="/tags/%E7%BB%93%E8%AE%BA/" style="font-size:13px">结论</a> <a href="/tags/%E7%BE%A4%E8%AE%BA/" style="font-size:13px">群论</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13px">字符串</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size:13px">线性代数</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size:13px">矩阵</a> <a href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" style="font-size:14px">多项式</a> <a href="/tags/%E6%94%AF%E9%85%8D%E6%A0%91/" style="font-size:13px">支配树</a> <a href="/tags/%E5%9B%BE%E8%AE%BA/" style="font-size:14px">图论</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:13px">数学</a></div></div><div class="widget"><div class="widget-title">Links</div><ul class="links-list"><li class="links-list-item"><a href="https://cnblogs.com/dedicatus545" title="dedicatus545" target="_blank">dedicatus545</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://blog.sshockwave.net" title="sshockwave" target="_blank">sshockwave</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://www.cnblogs.com/dcdcbigbig/" title="DCDCbigbig" target="_blank">DCDCbigbig</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://www.cnblogs.com/JackyhhJuRuo/" title="Jackyhh" target="_blank">Jackyhh</a></li></ul></div></div></div></div><div id="footer">© <a href="/" real="nofollow">Blog | qzkszj.</a><i> Powered by </i><a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a></div></body></html>