<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>x265参数小试 - Blog | qzkszj</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0/normalize.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0/build/pure-min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0/build/grids-responsive-min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/atom-one-light.css"><style>.category-list-item{display:flex}.category-list-link{flex:1 0 auto}.category-list-count{text-align:right}.post .post-content pre code{padding:0 0}</style><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Blog | qzkszj" type="application/atom+xml"></head><body class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">x265参数小试</h1><a id="logo" href="/">Blog | qzkszj</a><p class="description">过往如烟。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined">Home</i></a><a href="/archives/"><i class="fa undefined"> Archive</i></a><a href="/about/"><i class="fa undefined"> About</i></a><a href="/atom.xml"><i class="fa undefined"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">x265参数小试</h1><div class="post-meta">October 20,2019<span> | </span><span class="category"></span><span> | 618,2 mins.</span><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span></span><span id="busuanzi_container_page_pv"> | views: <span id="busuanzi_value_page_pv"></span></span></div><div class="tags"></div><div class="post-content"><p>关于x265，想要最佳性价比 <s>请直接medium</s></p><p><s>众所周知</s>，x265的默认参数设定比起x264显得不尽人意（至少在某些方面上）。<br>大众的电脑通常会出现一个很尴尬的问题就是slower太慢slow太快（slow速度是slower的4倍左右）。<br>在这里给出一些数据，还有我自己的调整的preset。（只在720p下测试）<br>这些并不能说优秀，只能说是一个折中的选择吧。。<br>基本测试集只有3个（但动-静，真人-游戏都有）。有一些没测完只能当结论用。。<br>rect和amp两大玄学参数我到现在都还没搞明白规律。。<br>版本： 3.2</p><pre><code class="hljs">x265 <span class="hljs-attr">--y4m</span> - <span class="hljs-attr">--preset</span> slower <span class="hljs-attr">--no-amp</span> <span class="hljs-attr">--cbqpoffs</span> -<span class="hljs-number">1</span> <span class="hljs-attr">--crqpoffs</span> -<span class="hljs-number">1</span> \
    <span class="hljs-attr">--limit-refs</span>=<span class="hljs-number">3</span> <span class="hljs-attr">--rd</span>=<span class="hljs-number">4</span> <span class="hljs-attr">--rc-lookahead</span>=<span class="hljs-number">60</span> \
    <span class="hljs-attr">--no-open-gop</span> <span class="hljs-attr">--merange</span> <span class="hljs-number">44</span> <span class="hljs-attr">--crf</span> <span class="hljs-number">26</span> -o out<span class="hljs-selector-class">.hevc</span>
</code></pre><p>参数是累加的。后面的选项计算速度增幅时前面的选项都是调整后的。BD-Rate用psnr计算。<br>amp(on-&gt;off): 压缩率变化小于0.2%。关闭的速度提升在8% ~ 20%。但是偶尔会有一两个clip没有速度提升（？？？）<br>limit-refs(1-&gt;3)：速度是原来的 140% ~ 150%，码率增加 0.7% ~ 0.9%<br>rd(6-&gt;4)：速度是原来的 200% ~ 220%，码率增加 0.6% ~ 4%<br>rc-lookahead(40-&gt;60)码率减少-0.1%（没看错） ~ 0.3%，不过反正不影响速度又不缺内存也无所谓。</p><p>merange算是一个讨论点吧（虽然我觉得速度根本变不了多少）<br>有些论坛上的人大胆地把它从57调到25，2333<br>自已也测试了一下,速度正表示提升。</p><table><thead><tr><th style="text-align:center">- Range -</th><th style="text-align:center">- Speed -</th><th style="text-align:center">- BD-Rate -</th></tr></thead><tbody><tr><td style="text-align:center">25</td><td style="text-align:center">+7.46%</td><td style="text-align:center">+0.74%</td></tr><tr><td style="text-align:center">38</td><td style="text-align:center">+4.55%</td><td style="text-align:center">+0.32%</td></tr><tr><td style="text-align:center">44</td><td style="text-align:center">+3.36%</td><td style="text-align:center">+0.13%</td></tr><tr><td style="text-align:center">可以看见调到44时的speed-quality的trade-off还说得过去</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">但调到38时就已经降得很厉害了</td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><p>wpp（不在参数中）: 优化多线程，增加多核CPU占用率<br>之前在awcy上经常看见x265编码的时候要加–no-wpp，在本地测试了一下。<br>不开wpp比开wpp有1% ~ 2%的码率节省。<br>但是本地测的单线程速度完全一样，完全不像awcy那样达到50% ~ 70%的速度提升。</p><p>本来在加上这些以后还想加一个众所周知的–no-rect，做了一下测试：<br>速度增加20% ~ 27%，码率增加2% ~ 3.7%<br>感觉性价比甚至不如merange，所以最后就没加。。</p><p>累加起来大概就是这样了(与两个preset对比)：</p><table><thead><tr><th style="text-align:center">- Preset -</th><th style="text-align:center">- Speed -</th><th style="text-align:center">- BD-Rate -</th></tr></thead><tbody><tr><td style="text-align:center">slower</td><td style="text-align:center">341%</td><td style="text-align:center">+2.85%</td></tr><tr><td style="text-align:center">slow</td><td style="text-align:center">79%</td><td style="text-align:center">-3.41%</td></tr></tbody></table></div><div class="page-navigator"><a class="pre" href="/2019-10/EZOJ3250/">Previous</a><a class="next" href="/2019-07/NOI2019/">Next</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title">Categories</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Note/">Note</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recollections/">Recollections</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solution/">Solution</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Starred/">Starred</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title">Tags</div><div class="tagcloud"><a href="/tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/" style="font-size:15px">组合数学</a> <a href="/tags/DP-%E4%BC%98%E5%8C%96/" style="font-size:15px">DP/优化</a> <a href="/tags/%E6%95%B0%E8%AE%BA/" style="font-size:16px">数论</a> <a href="/tags/%E5%AE%B9%E6%96%A5/" style="font-size:13px">容斥</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size:13px">集合</a> <a href="/tags/%E5%81%8F%E5%BA%8F/" style="font-size:13px">偏序</a> <a href="/tags/%E6%A0%91/" style="font-size:13px">树</a> <a href="/tags/%E6%8B%93%E6%89%91/" style="font-size:13px">拓扑</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" style="font-size:14px">网络流</a> <a href="/tags/%E7%BB%93%E8%AE%BA/" style="font-size:13px">结论</a> <a href="/tags/%E7%BE%A4%E8%AE%BA/" style="font-size:13px">群论</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13px">字符串</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size:13px">线性代数</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size:13px">矩阵</a> <a href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" style="font-size:14px">多项式</a> <a href="/tags/%E6%94%AF%E9%85%8D%E6%A0%91/" style="font-size:13px">支配树</a> <a href="/tags/%E5%9B%BE%E8%AE%BA/" style="font-size:14px">图论</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:13px">数学</a></div></div><div class="widget"><div class="widget-title">Links</div><ul class="links-list"><li class="links-list-item"><a href="https://cnblogs.com/dedicatus545" title="dedicatus545" target="_blank">dedicatus545</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://blog.sshockwave.net" title="sshockwave" target="_blank">sshockwave</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://www.cnblogs.com/dcdcbigbig/" title="DCDCbigbig" target="_blank">DCDCbigbig</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="https://www.cnblogs.com/JackyhhJuRuo/" title="Jackyhh" target="_blank">Jackyhh</a></li></ul></div></div></div></div><div id="footer">© <a href="/" real="nofollow">Blog | qzkszj.</a><i> Powered by </i><a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a></div></body></html>